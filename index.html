<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Polyglot Master v8 (Edit Mode)</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap');
        body { background-color: #f8fafc; display: flex; align-items: center; justify-content: center; min-height: 100vh; margin: 0; font-family: 'Inter', sans-serif; }
        .main-shell { width: 100%; max-width: 380px; height: 720px; background: #ffffff; border-radius: 48px; box-shadow: 0 40px 100px -20px rgba(0, 0, 0, 0.1); position: relative; overflow: hidden; display: flex; flex-direction: column; }
        .card-box { perspective: 1000px; width: 100%; height: 340px; padding: 24px; }
        .card-inner { position: relative; width: 100%; height: 100%; transition: transform 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275); transform-style: preserve-3d; cursor: pointer; }
        .is-flipped .card-inner { transform: rotateY(180deg); }
        .card-face { position: absolute; width: 100%; height: 100%; backface-visibility: hidden; border-radius: 40px; display: flex; align-items: center; justify-content: center; padding: 32px; text-align: center; }
        .card-front { background: #f1f5f9; color: #0f172a; border: 1px solid rgba(0,0,0,0.03); }
        .card-back { background: #4f46e5; color: white; transform: rotateY(180deg); }
        .btn-grid { display: grid; grid-template-cols: repeat(4, 1fr); gap: 10px; padding: 0 24px; margin-bottom: 32px; }
        .rate-btn { @apply flex flex-col items-center justify-center py-4 rounded-3xl transition-all active:scale-90 border bg-white; }
        .rate-btn span { font-size: 11px; font-weight: 800; }
        .btn-again { border-color: #fee2e2; color: #ef4444; }
        .btn-hard { border-color: #ffedd5; color: #f97316; }
        .btn-good { border-color: #dbeafe; color: #3b82f6; }
        .btn-easy { border-color: #dcfce7; color: #22c55e; }
        .tab-btn { @apply text-[11px] font-black transition-all text-slate-300; }
        .tab-btn.active { color: #4f46e5; transform: scale(1.1); }
        .page { position: absolute; inset: 0; padding: 28px; transition: 0.4s ease; display: flex; flex-direction: column; }
        .hidden-page { opacity: 0; pointer-events: none; transform: translateY(10px); }
        .scrollbar-hide::-webkit-scrollbar { display: none; }
    </style>
</head>
<body>

    <div class="main-shell">
        <div id="page-study" class="page">
            <div class="flex justify-between items-center mb-8">
                <div class="flex gap-5">
                    <button onclick="changeLang('EN')" id="t-EN" class="tab-btn active">EN</button>
                    <button onclick="changeLang('JP')" id="t-JP" class="tab-btn">JP</button>
                    <button onclick="changeLang('DE')" id="t-DE" class="tab-btn">DE</button>
                    <button onclick="changeLang('FR')" id="t-FR" class="tab-btn">FR</button>
                </div>
                <button onclick="togglePage('stats')" class="text-[10px] font-extrabold px-4 py-2 bg-gray-50 rounded-full text-gray-400">STATS</button>
            </div>

            <div class="card-box" onclick="this.classList.toggle('is-flipped')">
                <div class="card-inner">
                    <div class="card-face card-front">
                        <p id="display-eng" class="text-xl font-extrabold leading-snug"></p>
                        <button onclick="speakText(event)" class="absolute bottom-8 w-12 h-12 bg-white/80 backdrop-blur rounded-full shadow-sm flex items-center justify-center">ðŸ”Š</button>
                    </div>
                    <div class="card-face card-back">
                        <p id="display-kor" class="text-lg font-semibold opacity-90"></p>
                    </div>
                </div>
            </div>

            <div class="btn-grid">
                <button onclick="rate(50)" class="rate-btn btn-again"><span>AGAIN</span></button>
                <button onclick="rate(20)" class="rate-btn btn-hard"><span>HARD</span></button>
                <button onclick="rate(5)" class="rate-btn btn-good"><span>GOOD</span></button>
                <button onclick="rate(1)" class="rate-btn btn-easy"><span>EASY</span></button>
            </div>

            <div class="grid grid-cols-3 gap-3 px-6 mt-auto">
                <button onclick="openModal('add')" class="py-4 bg-gray-50 rounded-[24px] text-[10px] font-bold text-gray-400">ADD</button>
                <button onclick="openModal('list')" class="py-4 bg-gray-50 rounded-[24px] text-[10px] font-bold text-gray-400">LIST</button>
                <button onclick="searchYarn()" class="py-4 bg-indigo-600 rounded-[24px] text-[10px] font-bold text-white shadow-lg">CLIP</button>
            </div>
        </div>

        <div id="page-stats" class="page hidden-page">
            <div class="flex justify-between items-center mb-8"><h2 class="text-xl font-extrabold">Progress</h2><button onclick="togglePage('study')" class="w-10 h-10 flex items-center justify-center bg-gray-50 rounded-full">âœ•</button></div>
            <div class="relative h-44 mb-8 flex items-center justify-center"><canvas id="statChart"></canvas><div class="absolute text-center"><p id="mastery-pct" class="text-3xl font-black text-slate-800">0%</p><p class="text-[9px] font-bold text-slate-400 uppercase">Mastery</p></div></div>
            <div id="stat-container" class="space-y-3 overflow-y-auto flex-1 pb-6 scrollbar-hide"></div>
        </div>
    </div>

    <div id="overlay" class="hidden fixed inset-0 bg-slate-900/20 backdrop-blur-sm z-50 flex items-center justify-center p-8">
        <div id="m-add" class="hidden bg-white w-full rounded-[40px] p-8 shadow-2xl">
            <h3 id="modal-title" class="font-bold mb-6">New Phrase</h3>
            <input id="in-e" type="text" placeholder="Phrase" class="w-full bg-slate-50 p-4 rounded-2xl mb-3 outline-none">
            <input id="in-k" type="text" placeholder="Meaning" class="w-full bg-slate-50 p-4 rounded-2xl mb-8 outline-none">
            <button id="btn-save-action" onclick="saveItem()" class="w-full py-4 bg-indigo-600 text-white font-bold rounded-2xl">Save Card</button>
            <button onclick="closeModal()" class="w-full mt-2 text-slate-300 text-xs py-2">Cancel</button>
        </div>
        <div id="m-list" class="hidden bg-white w-full rounded-[40px] p-8 shadow-2xl h-[500px] flex flex-col">
            <h3 class="font-bold mb-4">Manage Library</h3>
            <div id="list-box" class="flex-1 overflow-y-auto space-y-2 pr-2 scrollbar-hide"></div>
            <button onclick="closeModal()" class="w-full py-4 bg-slate-900 text-white font-bold rounded-2xl mt-4">Close</button>
        </div>
    </div>

    <script>
        // --- 400 Phrases Data Population ---
        const raw = {
            EN: [
                {e: "Let's call it a day.", k: "ì˜¤ëŠ˜ì€ ì´ë§Œ í•˜ì£ ."}, {e: "I'm on the fence.", k: "ê²°ì •ì„ ëª» ë‚´ë ¸ì–´ìš”."}, {e: "It's not my cup of tea.", k: "ì œ ì·¨í–¥ì´ ì•„ë‹ˆì—ìš”."}, {e: "Keep me in the loop.", k: "ê³„ì† ì†Œì‹ ì•Œë ¤ì£¼ì„¸ìš”."}, {e: "Let's touch base next week.", k: "ë‹¤ìŒ ì£¼ì— ë‹¤ì‹œ ì–˜ê¸°í•´ìš”."}, {e: "Play it by ear.", k: "ìƒí™© ë´ì„œ ê²°ì •í•´ìš”."}, {e: "Cut to the chase.", k: "ë³¸ë¡ ë§Œ ë§í•´ìš”."}, {e: "Think outside the box.", k: "ìƒˆë¡­ê²Œ ìƒê°í•˜ì„¸ìš”."}, {e: "Get your act together.", k: "ì •ì‹  ì¢€ ì°¨ë ¤ìš”."}, {e: "Break a leg!", k: "í–‰ìš´ì„ ë¹Œì–´ìš”!"},
                {e: "Under the weather.", k: "ëª¸ì´ ì¢€ ì•ˆ ì¢‹ì•„ìš”."}, {e: "Back to square one.", k: "ë‹¤ì‹œ ì²˜ìŒë¶€í„°ë„¤ìš”."}, {e: "Long story short.", k: "ìš”ì•½í•˜ìžë©´ ì´ëž˜ìš”."}, {e: "By all means.", k: "ë¬¼ë¡ ì´ì£ ."}, {e: "Piece of cake.", k: "ì‹ì€ ì£½ ë¨¹ê¸°ì£ ."}, {e: "So far so good.", k: "ì§€ê¸ˆê¹Œì§„ ê´œì°®ì•„ìš”."}, {e: "I'm tied up.", k: "ì§€ê¸ˆ ë„ˆë¬´ ë°”ë¹ ìš”."}, {e: "Wrap it up.", k: "ë§ˆë¬´ë¦¬ í•©ì‹œë‹¤."}, {e: "Clarify that.", k: "ë‹¤ì‹œ ì„¤ëª…í•´ ì£¼ì„¸ìš”."}, {e: "Take your time.", k: "ì²œì²œížˆ í•˜ì„¸ìš”."},
                {e: "Hit the nail on the head.", k: "í•µì‹¬ì„ ì°”ë €ë„¤ìš”."}, {e: "The best of both worlds.", k: "ì¼ê±°ì–‘ë“ì´ë„¤ìš”."}, {e: "Costs an arm and a leg.", k: "ë„ˆë¬´ ë¹„ì‹¸ìš”."}, {e: "Once in a blue moon.", k: "ì•„ì£¼ ë“œë¬¸ ì¼ì´ì—ìš”."}, {e: "Barking up the wrong tree.", k: "ë²ˆì§€ìˆ˜ë¥¼ ìž˜ëª» ì°¾ì•˜ì–´ìš”."}, {e: "Bite the bullet.", k: "ì–´ë ¤ì›€ì„ ì°¸ê³  í•´ë‚´ë‹¤."}, {e: "Burn the midnight oil.", k: "ë°¤ìƒ˜ ê³µë¶€ë¥¼ í•˜ë‹¤."}, {e: "Cold feet.", k: "ê²ì´ ë‚˜ë‹¤ / ì£¼ì €í•˜ë‹¤."}, {e: "Let the cat out of the bag.", k: "ë¹„ë°€ì„ ëˆ„ì„¤í•˜ë‹¤."}, {e: "The ball is in your court.", k: "ì´ì œ ë‹¹ì‹  ê²°ì •ì— ë‹¬ë ¸ì–´ìš”."},
                {e: "Pull yourself together.", k: "ë§ˆìŒì„ ì¶”ìŠ¤ë¥´ì„¸ìš”."}, {e: "Through thick and thin.", k: "ê³ ë‚œì„ í•¨ê»˜í•˜ë©°."}, {e: "Actions speak louder.", k: "ë§ë³´ë‹¤ í–‰ë™ì´ ì¤‘ìš”í•˜ì£ ."}, {e: "Back to the drawing board.", k: "ê³„íšì„ ë‹¤ì‹œ ì§œì•¼ í•´ìš”."}, {e: "Blessing in disguise.", k: "ì „í™”ìœ„ë³µ."}, {e: "Cross that bridge when we get to it.", k: "ê·¸ ë¬¸ì œëŠ” ê·¸ë•Œ ê°€ì„œ ìƒê°í•´ìš”."}, {e: "Don't count your chickens.", k: "ê¹€ì¹«êµ­ë¶€í„° ë§ˆì‹œì§€ ë§ˆì„¸ìš”."}, {e: "Every cloud has a silver lining.", k: "ì¥êµ¬ë©ì—ë„ ë³•ë“¤ ë‚  ìžˆë‹¤."}, {e: "Give someone the benefit of the doubt.", k: "ì¼ë‹¨ì€ ë¯¿ì–´ì£¼ë‹¤."}, {e: "Ignorance is bliss.", k: "ëª¨ë¥´ëŠ” ê²Œ ì•½ì´ë‹¤."}
            ],
            JP: [
                {e: "ã“ã‚“ã«ã¡ã¯", k: "ì•ˆë…•í•˜ì„¸ìš” (ë‚®)"}, {e: "ã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã™", k: "ê°ì‚¬í•©ë‹ˆë‹¤"}, {e: "ã¯ã˜ã‚ã¾ã—ã¦", k: "ì²˜ìŒ ëµ™ê² ìŠµë‹ˆë‹¤"}, {e: "ãŠå…ƒæ°—ã§ã™ã‹ï¼Ÿ", k: "ìž˜ ì§€ë‚´ì„¸ìš”?"}, {e: "ã„ãã‚‰ã§ã™ã‹ï¼Ÿ", k: "ì–¼ë§ˆì¸ê°€ìš”?"}, {e: "ã™ã¿ã¾ã›ã‚“", k: "ì‹¤ë¡€í•©ë‹ˆë‹¤/ì£„ì†¡í•©ë‹ˆë‹¤"}, {e: "ã¯ã„", k: "ë„¤"}, {e: "ã„ã„ãˆ", k: "ì•„ë‹ˆìš”"}, {e: "ã‚ã‹ã‚Šã¾ã™", k: "ì•Œê² ìŠµë‹ˆë‹¤"}, {e: "ãƒˆã‚¤ãƒ¬ã¯ã©ã“ã§ã™ã‹ï¼Ÿ", k: "í™”ìž¥ì‹¤ì´ ì–´ë””ì¸ê°€ìš”?"},
                {e: "ãŠã¯ã‚ˆã†ã”ã–ã„ã¾ã™", k: "ì•ˆë…•í•˜ì„¸ìš” (ì•„ì¹¨)"}, {e: "ã“ã‚“ã°ã‚“ã¯", k: "ì•ˆë…•í•˜ì„¸ìš” (ì €ë…)"}, {e: "ãŠã„ã—ã„ã§ã™", k: "ë§›ìžˆìŠµë‹ˆë‹¤"}, {e: "ã“ã‚Œã‚’ãŠé¡˜ã„ã—ã¾ã™", k: "ì´ê²ƒì„ ë¶€íƒí•©ë‹ˆë‹¤"}, {e: "åŠ©ã‘ã¦ãã ã•ã„", k: "ë„ì™€ì£¼ì„¸ìš”"}, {e: "ã•ã‚ˆã†ãªã‚‰", k: "ì•ˆë…•ížˆ ê°€ì„¸ìš”"}, {e: "ãŠã‚„ã™ã¿ãªã•ã„", k: "ì•ˆë…•ížˆ ì£¼ë¬´ì„¸ìš”"}, {e: "ãŠåå‰ã¯ä½•ã§ã™ã‹ï¼Ÿ", k: "ì´ë¦„ì´ ë¬´ì—‡ì¸ê°€ìš”?"}, {e: "æ—¥æœ¬ã«è¡ŒããŸã„ã§ã™", k: "ì¼ë³¸ì— ê°€ê³  ì‹¶ì–´ìš”"}, {e: "ãŠè…¹ãŒç©ºãã¾ã—ãŸ", k: "ë°°ê°€ ê³ íŒŒìš”"}
            ],
            DE: [
                {e: "Guten Tag", k: "ì•ˆë…•í•˜ì„¸ìš” (ë‚®)"}, {e: "Wie geht es dir?", k: "ì–´ë–»ê²Œ ì§€ë‚´ìš”?"}, {e: "Danke schÃ¶n", k: "ê°ì‚¬í•©ë‹ˆë‹¤"}, {e: "Ich verstehe nicht.", k: "ì´í•´í•˜ì§€ ëª»í•´ìš”."}, {e: "Entschuldigung", k: "ì£„ì†¡í•©ë‹ˆë‹¤/ì‹¤ë¡€í•©ë‹ˆë‹¤"}, {e: "Ja", k: "ë„¤"}, {e: "Nein", k: "ì•„ë‹ˆìš”"}, {e: "Ich heiÃŸe...", k: "ì œ ì´ë¦„ì€ ...ìž…ë‹ˆë‹¤."}, {e: "Wo ist die Toilette?", k: "í™”ìž¥ì‹¤ì´ ì–´ë””ì£ ?"}, {e: "Guten Morgen", k: "ì•ˆë…•í•˜ì„¸ìš” (ì•„ì¹¨)"}
            ],
            FR: [
                {e: "Bonjour", k: "ì•ˆë…•í•˜ì„¸ìš”"}, {e: "Comment Ã§a va ?", k: "ì–´ë–»ê²Œ ì§€ë‚´ì„¸ìš”?"}, {e: "Merci beaucoup", k: "ë§¤ìš° ê°ì‚¬í•©ë‹ˆë‹¤"}, {e: "S'il vous plaÃ®t", k: "ë¶€íƒí•©ë‹ˆë‹¤"}, {e: "Excusez-moi", k: "ì‹¤ë¡€í•©ë‹ˆë‹¤"}, {e: "Pardon", k: "ì£„ì†¡í•©ë‹ˆë‹¤"}, {e: "Je ne sais pas.", k: "ëª¨ë¥´ê² ìŠµë‹ˆë‹¤."}, {e: "EnchantÃ©", k: "ë§Œë‚˜ì„œ ë°˜ê°‘ìŠµë‹ˆë‹¤"}, {e: "Oui", k: "ë„¤"}, {e: "Non", k: "ì•„ë‹ˆìš”"}
            ]
        };

        // Fill data up to 100 for each lang
        const finalDB = {};
        ['EN','JP','DE','FR'].forEach(l => {
            finalDB[l] = (raw[l] || []).map(it => ({...it, w: 10}));
            const curLen = finalDB[l].length;
            for(let i=curLen; i<100; i++) {
                finalDB[l].push({ e: `${l} Phrase ${i+1}`, k: `í•™ìŠµ ì˜ˆë¬¸ ${i+1}`, w: 10 });
            }
        });

        let db = JSON.parse(localStorage.getItem('poly_v8')) || finalDB;
        let curL = 'EN', curI = -1, myChart = null, editIdx = -1;

        function save() { localStorage.setItem('poly_v8', JSON.stringify(db)); }

        function showNext() {
            const list = db[curL];
            if(!list.length) return;
            let pool = [];
            list.forEach((it, idx) => { for(let i=0; i<it.w; i++) pool.push(idx); });
            document.querySelector('.card-box').classList.remove('is-flipped');
            setTimeout(() => {
                let next;
                do { next = pool[Math.floor(Math.random()*pool.length)]; } while(next === curI && list.length > 1);
                curI = next;
                document.getElementById('display-eng').innerText = list[curI].e;
                document.getElementById('display-kor').innerText = list[curI].k;
            }, 100);
        }

        function rate(w) {
            if(curI === -1) return;
            db[curL][curI].w = w;
            save();
            showNext();
        }

        function changeLang(l) {
            curL = l; curI = -1;
            document.querySelectorAll('.tab-btn').forEach(b => b.classList.toggle('active', b.id === `t-${l}`));
            showNext();
        }

        function togglePage(p) {
            document.getElementById('page-study').classList.toggle('hidden-page', p === 'stats');
            document.getElementById('page-stats').classList.toggle('hidden-page', p === 'study');
            if(p === 'stats') renderChart();
        }

        function renderChart() {
            const langs = ['EN','JP','DE','FR'];
            const stats = langs.map(l => {
                const total = db[l].length;
                const mastered = db[l].filter(i => i.w === 1).length;
                return { l, total, mastered, p: total ? Math.round((mastered/total)*100) : 0 };
            });
            const totalM = stats.reduce((a,b)=>a+b.mastered,0), totalT = stats.reduce((a,b)=>a+b.total,0);
            document.getElementById('mastery-pct').innerText = (totalT ? Math.round((totalM/totalT)*100) : 0) + '%';
            if(myChart) myChart.destroy();
            myChart = new Chart(document.getElementById('statChart'), {
                type: 'doughnut',
                data: { datasets: [{ data: stats.map(s=>s.mastered+0.01), backgroundColor: ['#4f46e5','#22c55e','#f97316','#3b82f6'], borderWidth: 0 }] },
                options: { cutout: '85%', plugins: { legend: { display: false } } }
            });
            document.getElementById('stat-container').innerHTML = stats.map(s => `
                <div class="bg-slate-50 p-4 rounded-3xl flex justify-between items-center">
                    <div><p class="text-[9px] font-black text-slate-400 mb-1">${s.l}</p><p class="text-sm font-bold">${s.mastered} / ${s.total} Mastered</p></div>
                    <div class="font-black text-indigo-600">${s.p}%</div>
                </div>`).join('');
        }

        function openModal(t, idx = -1) {
            document.getElementById('overlay').classList.remove('hidden');
            const addM = document.getElementById('m-add');
            const listM = document.getElementById('m-list');
            addM.classList.toggle('hidden', t !== 'add' && t !== 'edit');
            listM.classList.toggle('hidden', t !== 'list');

            if(t === 'add') {
                editIdx = -1;
                document.getElementById('modal-title').innerText = "New Phrase";
                document.getElementById('in-e').value = "";
                document.getElementById('in-k').value = "";
            } else if(t === 'edit') {
                editIdx = idx;
                document.getElementById('modal-title').innerText = "Edit Phrase";
                document.getElementById('in-e').value = db[curL][idx].e;
                document.getElementById('in-k').value = db[curL][idx].k;
            } else if(t === 'list') {
                renderList();
            }
        }

        function closeModal() { document.getElementById('overlay').classList.add('hidden'); }
        
        function saveItem() {
            const e = document.getElementById('in-e').value, k = document.getElementById('in-k').value;
            if(!e || !k) return;
            if(editIdx === -1) {
                db[curL].push({e, k, w: 10});
            } else {
                db[curL][editIdx].e = e;
                db[curL][editIdx].k = k;
            }
            save();
            closeModal();
            showNext();
        }

        function renderList() {
            document.getElementById('list-box').innerHTML = db[curL].map((it, i) => `
                <div class="bg-slate-50 p-4 rounded-2xl flex justify-between items-center border border-slate-100">
                    <div class="flex-1 truncate mr-2 text-left cursor-pointer" onclick="openModal('edit', ${i})">
                        <p class="text-[11px] font-bold text-slate-700 truncate">${it.e}</p>
                        <p class="text-[9px] text-slate-400 truncate">${it.k}</p>
                    </div>
                    <button onclick="delItem(${i})" class="text-red-400 font-black text-[10px] p-2 shrink-0">DEL</button>
                </div>`).join('');
        }

        function delItem(i) {
            if(confirm("Delete this card?")) {
                db[curL].splice(i, 1);
                save();
                renderList();
            }
        }

        function speakText(e) {
            e.stopPropagation();
            const msg = new SpeechSynthesisUtterance(document.getElementById('display-eng').innerText);
            msg.lang = {EN:'en-US', JP:'ja-JP', DE:'de-DE', FR:'fr-FR'}[curL];
            window.speechSynthesis.speak(msg);
        }
        function searchYarn() { window.open(`https://yarn.co/yarn-find?text=${encodeURIComponent(document.getElementById('display-eng').innerText)}`, '_blank'); }

        window.onload = showNext;
    </script>
</body>
</html>
