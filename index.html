<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Polyglot Flashcards Pro</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;700;900&family=Noto+Sans+KR:wght@400;700;900&display=swap');
        
        body {
            background-color: #f3f4f6;
            display: flex; align-items: center; justify-content: center;
            min-height: 100vh; margin: 0; 
            font-family: 'Inter', 'Noto Sans KR', sans-serif;
        }

        .main-shell {
            width: 100%; max-width: 390px; height: 720px;
            background: #ffffff; border-radius: 40px;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.1);
            position: relative; overflow: hidden;
            display: flex; flex-direction: column;
        }

        /* Card Animation */
        .card-box { perspective: 1000px; width: 100%; height: 320px; padding: 20px; }
        .card-inner { 
            position: relative; width: 100%; height: 100%; 
            transition: transform 0.6s cubic-bezier(0.23, 1, 0.32, 1);
            transform-style: preserve-3d;
        }
        .is-flipped .card-inner { transform: rotateY(180deg); }
        .card-face {
            position: absolute; width: 100%; height: 100%;
            backface-visibility: hidden;
            border-radius: 30px; display: flex; align-items: center; justify-content: center;
            padding: 30px; text-align: center;
        }
        .card-front { background: #f9fafb; border: 1px solid #f1f5f9; color: #1f2937; }
        .card-back { background: #4f46e5; color: white; transform: rotateY(180deg); }

        /* Review Buttons */
        .rev-btn {
            @apply flex-1 flex flex-col items-center justify-center py-5 rounded-3xl transition-all active:scale-95;
            border: 1px solid rgba(0,0,0,0.03);
        }
        .rev-btn .label-en { font-size: 10px; font-weight: 900; letter-spacing: 0.05em; margin-bottom: 2px; }
        .rev-btn .label-ko { font-size: 14px; font-weight: 700; }

        /* Navigation Tabs */
        .tab-active { color: #4f46e5; font-weight: 900; border-bottom: 2px solid #4f46e5; }
        
        .page { position: absolute; inset: 0; padding: 24px; transition: 0.4s; display: flex; flex-direction: column; }
        .hide-left { transform: translateX(-100%); opacity: 0; pointer-events: none; }
        .hide-right { transform: translateX(100%); opacity: 0; pointer-events: none; }
    </style>
</head>
<body>

    <div class="main-shell">
        <div id="page-study" class="page">
            <header class="flex justify-between items-center mb-10">
                <div class="flex gap-4">
                    <button onclick="changeLang('EN')" id="l-EN" class="pb-1 text-xs font-bold tab-active">EN</button>
                    <button onclick="changeLang('JP')" id="l-JP" class="pb-1 text-xs font-bold text-gray-300">JP</button>
                    <button onclick="changeLang('DE')" id="l-DE" class="pb-1 text-xs font-bold text-gray-300">DE</button>
                    <button onclick="changeLang('FR')" id="l-FR" class="pb-1 text-xs font-bold text-gray-300">FR</button>
                </div>
                <button onclick="goToPage('stats')" class="text-[10px] font-black bg-gray-100 px-3 py-1.5 rounded-full text-gray-500">MY STATS</button>
            </header>

            <div class="card-box mb-6" id="card-trigger" onclick="this.classList.toggle('is-flipped')">
                <div class="card-inner">
                    <div class="card-face card-front">
                        <p id="txt-main" class="text-2xl font-black break-keep leading-tight tracking-tight">Focus on progress.</p>
                        <button onclick="speakText(event)" class="absolute bottom-6 w-12 h-12 bg-white rounded-full shadow-sm flex items-center justify-center border border-gray-100 active:scale-90 transition-transform">üîä</button>
                    </div>
                    <div class="card-face card-back">
                        <p id="txt-sub" class="text-xl font-bold break-keep">Í≥ºÏ†ïÏùò ÏßÑÏ†ÑÏóê ÏßëÏ§ëÌïòÏÑ∏Ïöî.</p>
                    </div>
                </div>
            </div>

            <div class="flex gap-3 mb-12">
                <button onclick="rateDifficulty(50)" class="rev-btn bg-red-50 text-red-500">
                    <span class="label-en">AGAIN</span><span class="label-ko">Îã§Ïãú</span>
                </button>
                <button onclick="rateDifficulty(20)" class="rev-btn bg-orange-50 text-orange-500">
                    <span class="label-en">HARD</span><span class="label-ko">Ïñ¥Î†§ÏõÄ</span>
                </button>
                <button onclick="rateDifficulty(5)" class="rev-btn bg-blue-50 text-blue-500">
                    <span class="label-en">GOOD</span><span class="label-ko">Í¥úÏ∞ÆÏùå</span>
                </button>
                <button onclick="rateDifficulty(1)" class="rev-btn bg-emerald-50 text-emerald-600">
                    <span class="label-en">EASY</span><span class="label-ko">Ïâ¨ÏõÄ</span>
                </button>
            </div>

            <div class="grid grid-cols-3 gap-3">
                <button onclick="openAdd()" class="py-4 bg-gray-50 rounded-3xl text-gray-400 font-bold text-xs border border-gray-100">Add Card</button>
                <button onclick="openManage()" class="py-4 bg-gray-50 rounded-3xl text-gray-400 font-bold text-xs border border-gray-100">Manage</button>
                <button onclick="searchYarn()" class="py-4 bg-indigo-600 rounded-3xl text-white font-bold text-xs shadow-lg shadow-indigo-100">Movie Clip</button>
            </div>
        </div>

        <div id="page-stats" class="page hide-right">
            <div class="flex justify-between items-center mb-10">
                <h2 class="text-xl font-black">Performance</h2>
                <button onclick="goToPage('study')" class="text-gray-400">‚úï</button>
            </div>
            <div class="relative h-48 mb-10 flex items-center justify-center">
                <canvas id="statChart"></canvas>
                <div class="absolute text-center">
                    <p id="stat-val" class="text-3xl font-black">0%</p>
                    <p class="text-[9px] font-bold text-gray-400">MASTERY</p>
                </div>
            </div>
            <div id="stat-list" class="space-y-4 overflow-y-auto"></div>
        </div>
    </div>

    <div id="modal-wrap" class="hidden fixed inset-0 bg-black/20 backdrop-blur-sm z-50 flex items-center justify-center p-6">
        <div id="modal-add" class="hidden bg-white w-full max-w-xs rounded-[40px] p-8 shadow-2xl">
            <h3 class="font-black text-lg mb-6">New Phrase</h3>
            <input id="in-eng" type="text" placeholder="Foreign Phrase" class="w-full bg-gray-50 p-4 rounded-2xl mb-3 outline-none border border-gray-100 focus:border-indigo-400">
            <input id="in-kor" type="text" placeholder="Meaning" class="w-full bg-gray-50 p-4 rounded-2xl mb-8 outline-none border border-gray-100 focus:border-indigo-400">
            <button onclick="saveNew()" class="w-full py-4 bg-indigo-600 text-white font-black rounded-2xl shadow-lg">Save Phrase</button>
            <button onclick="closeModal()" class="w-full mt-2 text-gray-300 text-sm font-bold py-2">Cancel</button>
        </div>
        <div id="modal-list" class="hidden bg-white w-full max-w-xs rounded-[40px] p-8 shadow-2xl h-[500px] flex flex-col">
            <h3 class="font-black text-lg mb-6">Manage Library</h3>
            <div id="lib-items" class="flex-1 overflow-y-auto space-y-3 mb-6 pr-2"></div>
            <button onclick="closeModal()" class="w-full py-4 bg-gray-900 text-white font-black rounded-2xl">Close</button>
        </div>
    </div>

    <script>
        const initialDB = {
            EN: [{e: "Consistency is key.", k: "Íæ∏Ï§ÄÌï®Ïù¥ ÎãµÏù¥Îã§.", w: 10}],
            JP: [{e: "Á∂ôÁ∂ö„ÅØÂäõ„Å™„Çä", k: "Í≥ÑÏÜçÌïòÎäî Í≤ÉÏù¥ ÌûòÏù¥Îã§.", w: 10}],
            DE: [{e: "√úbung macht den Meister.", k: "Ïó∞ÏäµÏù¥ ÎåÄÍ∞ÄÎ•º ÎßåÎì†Îã§.", w: 10}],
            FR: [{e: "C'est la vie.", k: "Í∑∏Í≤å Ïù∏ÏÉùÏù¥Ï£†.", w: 10}]
        };

        let db = JSON.parse(localStorage.getItem('polyglot_v4')) || initialDB;
        let curLang = 'EN';
        let curIdx = -1;
        let chartObj = null;

        function save() { localStorage.setItem('polyglot_v4', JSON.stringify(db)); }

        function showNext() {
            const list = db[curLang];
            if (list.length === 0) return;

            let pool = [];
            list.forEach((it, i) => { for(let n=0; n<it.w; n++) pool.push(i); });

            document.getElementById('card-trigger').classList.remove('is-flipped');
            setTimeout(() => {
                let n;
                do { n = pool[Math.floor(Math.random()*pool.length)]; } while(n === curIdx && list.length > 1);
                curIdx = n;
                document.getElementById('txt-main').innerText = list[curIdx].e;
                document.getElementById('txt-sub').innerText = list[curIdx].k;
            }, 150);
        }

        function rateDifficulty(weight) {
            if (curIdx === -1) return;
            db[curLang][curIdx].w = weight;
            save();
            showNext(); // Î∞îÎ°ú Îã§Ïùå Ïπ¥ÎìúÎ°ú
        }

        function changeLang(l) {
            curLang = l; curIdx = -1;
            ['EN','JP','DE','FR'].forEach(id => {
                const btn = document.getElementById(`l-${id}`);
                btn.className = id === l ? "pb-1 text-xs font-bold tab-active" : "pb-1 text-xs font-bold text-gray-300";
            });
            showNext();
        }

        function goToPage(p) {
            const study = document.getElementById('page-study');
            const stats = document.getElementById('page-stats');
            if(p === 'stats') {
                study.classList.add('hide-left');
                stats.classList.remove('hide-right');
                renderStats();
            } else {
                study.classList.remove('hide-left');
                stats.classList.add('hide-right');
            }
        }

        function renderStats() {
            const ctx = document.getElementById('statChart').getContext('2d');
            const langs = ['EN','JP','DE','FR'];
            const data = langs.map(l => {
                const total = db[l].length;
                const done = db[l].filter(i => i.w === 1).length;
                return { l, total, done, p: total === 0 ? 0 : Math.round((done/total)*100) };
            });

            const avgP = Math.round(data.reduce((a,b)=>a+b.done,0) / Math.max(1, data.reduce((a,b)=>a+b.total,0)) * 100);
            document.getElementById('stat-val').innerText = avgP + '%';

            if(chartObj) chartObj.destroy();
            chartObj = new Chart(ctx, {
                type: 'doughnut',
                data: { datasets: [{ data: data.map(d=>d.done+0.1), backgroundColor: ['#4f46e5','#10b981','#f59e0b','#ef4444'], borderWidth: 0 }] },
                options: { cutout: '80%', plugins: { legend: { display: false } } }
            });

            document.getElementById('stat-list').innerHTML = data.map(d => `
                <div class="bg-gray-50 p-4 rounded-3xl flex justify-between items-center">
                    <div><p class="text-[10px] font-black text-gray-400">${d.l}</p><p class="text-sm font-bold">${d.done}/${d.total} Mastered</p></div>
                    <div class="text-right font-black text-indigo-600">${d.p}%</div>
                </div>
            `).join('');
        }

        function openAdd() { document.getElementById('modal-wrap').classList.remove('hidden'); document.getElementById('modal-add').classList.remove('hidden'); }
        function openManage() { 
            document.getElementById('modal-wrap').classList.remove('hidden'); 
            document.getElementById('modal-list').classList.remove('hidden');
            renderManage();
        }
        function closeModal() { document.getElementById('modal-wrap').classList.add('hidden'); document.getElementById('modal-add').classList.add('hidden'); document.getElementById('modal-list').classList.add('hidden'); }
        
        function saveNew() {
            const e = document.getElementById('in-eng').value.trim();
            const k = document.getElementById('in-kor').value.trim();
            if(e && k) { db[curLang].push({e, k, w: 10}); save(); closeModal(); showNext(); }
        }

        function renderManage() {
            const box = document.getElementById('lib-items');
            box.innerHTML = db[curLang].map((it, i) => `
                <div class="bg-gray-50 p-4 rounded-2xl flex justify-between items-center border border-gray-100">
                    <div class="text-left pr-2"><p class="text-[11px] font-bold text-gray-800 leading-tight">${it.e}</p></div>
                    <button onclick="delItem(${i})" class="text-red-500 font-bold text-[10px]">DEL</button>
                </div>
            `).join('');
        }
        function delItem(i) { db[curLang].splice(i, 1); save(); renderManage(); }

        function speakText(ev) {
            ev.stopPropagation();
            const speech = new SpeechSynthesisUtterance(document.getElementById('txt-main').innerText);
            speech.lang = {EN:'en-US', JP:'ja-JP', DE:'de-DE', FR:'fr-FR'}[curLang];
            window.speechSynthesis.speak(speech);
        }
        function searchYarn() { window.open(`https://yarn.co/yarn-find?text=${encodeURIComponent(document.getElementById('txt-main').innerText)}`, '_blank'); }

        window.onload = showNext;
    </script>
</body>
</html>
